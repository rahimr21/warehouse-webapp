{% extends "base.html" %}

{% block title %}Boxes - Warehouse Management{% endblock %}

{% block extra_css %}
<style>
    .search-box {
        max-width: 300px;
    }
    .box-totals {
        font-size: 0.9rem;
        color: #666;
    }
</style>
{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h1>Boxes</h1>
    <div class="d-flex gap-2">
        <a href="{{ url_for('voice_entry') }}" class="btn btn-success">ðŸŽ¤ Voice Entry</a>
        <a href="{{ url_for('new_box') }}" class="btn btn-primary">New Box</a>
    </div>
</div>

<div class="mb-3 d-flex align-items-center gap-3">
    <div class="form-check form-switch">
        <input class="form-check-input" type="checkbox" id="showInContainersToggle" 
               {% if show_in_containers == 'true' %}checked{% endif %}>
        <label class="form-check-label" for="showInContainersToggle">
            Show boxes in containers
        </label>
    </div>
    <input type="text" id="searchBox" class="form-control search-box" placeholder="Search boxes...">
</div>

<div class="table-responsive">
    <table class="table table-striped table-hover">
        <thead>
            <tr>
                <th>Box Number</th>
                <th>Weight</th>
                <th>Type</th>
                <th>Contents</th>
                <th>Created</th>
                <th>Status</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for box in boxes %}
            <tr class="box-row">
                <td>{{ box.box_number }}</td>
                <td>{{ "%.2f"|format(box.weight) }} lbs</td>
                <td>
                    <span class="badge bg-{{ 'primary' if box.box_type == 'detailed' else 'secondary' }}">
                        {{ box.box_type|title }}
                    </span>
                </td>
                <td>
                    {% set totals = box.calculate_totals() %}
                    {% for product_type, quantity in totals.items() %}
                        <div class="box-totals">{{ product_type }}: {{ quantity }}</div>
                    {% endfor %}
                    {% set lcd_sizes = box.calculate_lcd_sizes() %}
                    {% if lcd_sizes %}
                        <div class="box-totals text-info mt-1">
                            <small><strong>LCD Sizes:</strong>
                            {% for size, quantity in lcd_sizes.items() %}
                                {{ size }}: {{ quantity }}{% if not loop.last %}, {% endif %}
                            {% endfor %}
                            </small>
                        </div>
                    {% endif %}
                </td>
                <td>{{ box.created_at.strftime('%Y-%m-%d') }}</td>
                <td>
                    {% if box.container %}
                        <span class="badge bg-info">In Container</span>
                    {% else %}
                        <span class="badge bg-success">Available</span>
                    {% endif %}
                </td>
                <td>
                    <a href="{{ url_for('edit_box', box_id=box.id) }}" class="btn btn-sm btn-outline-primary">Edit</a>
                    <form method="POST" action="{{ url_for('delete_box', box_id=box.id) }}" style="display: inline;" 
                          onsubmit="return confirm('Are you sure you want to delete this box?')">
                        <button type="submit" class="btn btn-sm btn-outline-danger">Delete</button>
                    </form>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Search functionality
document.getElementById('searchBox').addEventListener('keyup', function() {
    const searchText = this.value.toLowerCase();
    const rows = document.getElementsByClassName('box-row');
    
    for (let row of rows) {
        const text = row.textContent.toLowerCase();
        row.style.display = text.includes(searchText) ? '' : 'none';
    }
});

// Toggle for showing boxes in containers
document.getElementById('showInContainersToggle').addEventListener('change', function() {
    const showInContainers = this.checked ? 'true' : 'false';
    const url = new URL(window.location.href);
    url.searchParams.set('show_in_containers', showInContainers);
    window.location.href = url.toString();
});
</script>
{% endblock %} 